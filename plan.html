<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Training Plan | Training Club</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <link rel="preload" href="static/js/main.js" as="script">
    <link rel="preload" href="static/js/plan.js" as="script">
    <link rel="preconnect" href="https://linktr.ee" crossorigin>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèãÔ∏è</text></svg>">
</head>
<body>
    <div class="notification-center" id="notificationCenter"></div>
    <div class="modal" id="confirmModal" style="display: none;"></div>
    
    <header>
        <div class="container">
            <button class="back-btn" onclick="window.location.href='index.html'">
                ‚Üê Home
            </button>
            <div>
                <h1>Your Training Plan</h1>
                <p>Personalized workout and nutrition guide</p>
            </div>
            <button class="logout-btn" onclick="logout()">
                Logout ‚Üí
            </button>
        </div>
    </header>
    
    <div class="container">
        <!-- User Info Section -->
        <div class="user-info">
            <div class="user-basic">
                <div class="user-avatar">U</div>
                <div class="user-details">
                    <div class="user-name">
                        <h2>Loading...</h2>
                    </div>
                    <div class="user-goal">
                        <p>Goal: Loading...</p>
                    </div>
                </div>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-value">--</div>
                    <div class="stat-label">BMI</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">--</div>
                    <div class="stat-label">Age</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">--</div>
                    <div class="stat-label">Height (cm)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">--</div>
                    <div class="stat-label">Weight (kg)</div>
                </div>
            </div>
        </div>

        <!-- BMI Information -->
        <div class="bmi-container" id="bmiContainer">
            <div class="bmi-header">
                <h2>Your BMI Analysis</h2>
                <div class="bmi-value" id="bmiValue">--</div>
            </div>
            <div class="bmi-scale">
                <div class="bmi-marker" id="bmiMarker"></div>
            </div>
            <div class="bmi-labels">
                <span>Underweight</span>
                <span>Normal</span>
                <span>Overweight</span>
                <span>Obese</span>
            </div>
            <div class="bmi-category" id="bmiCategory">
                <h3>Category: <span id="categoryText">--</span></h3>
                <p id="bmiRecommendation">Focus on healthy weight gain through balanced nutrition and strength training.</p>
            </div>
        </div>

        <!-- Workout Time Banner -->
        <div class="reminder-banner" id="workoutTimeBanner" style="display: none;">
            <div class="reminder-icon">‚è∞</div>
            <div>
                <strong>Workout Time Reminder</strong>
                <p>Your scheduled workout time is approaching. Ready to get stronger?</p>
            </div>
        </div>

        <!-- Main Plan Container -->
        <div class="plan-container">
            <!-- Workout Plan Card -->
            <div class="plan-card">
                <div class="plan-header">
                    <h2>üèãÔ∏è Workout Plan</h2>
                    <div class="plan-status" id="workoutStatus">Loading...</div>
                </div>
                <div class="plan-body">
                    <div class="plan-feature">
                        <div class="feature-icon">üí™</div>
                        <div class="feature-text">
                            <h3>Progressive Training</h3>
                            <p>Starts with 14 exercises, increases difficulty every 2 days</p>
                        </div>
                    </div>
                    <div class="plan-feature">
                        <div class="feature-icon">‚è±Ô∏è</div>
                        <div class="feature-text">
                            <h3>Time Tracking</h3>
                            <p>Real-time calorie burn calculation based on duration</p>
                        </div>
                    </div>
                    <div class="plan-feature">
                        <div class="feature-icon">üìà</div>
                        <div class="feature-text">
                            <h3>Progress Monitoring</h3>
                            <p>Visual progress tracking with day completion markers</p>
                        </div>
                    </div>
                    <div class="plan-feature">
                        <div class="feature-icon">üéØ</div>
                        <div class="feature-text">
                            <h3>Goal-Oriented</h3>
                            <p>Exercises tailored to your specific fitness goals</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nutrition Plan Card -->
            <div class="plan-card">
                <div class="plan-header">
                    <h2>ü•ó Nutrition Plan</h2>
                    <div class="plan-status" id="nutritionStatus">Loading...</div>
                </div>
                <div class="plan-body">
                    <div class="plan-feature">
                        <div class="feature-icon">üíé</div>
                        <div class="feature-text">
                            <h3>3-Tier System</h3>
                            <p>Choose from Basic, Medium, or Premium meal plans</p>
                        </div>
                    </div>
                    <div class="plan-feature">
                        <div class="feature-icon">üî¢</div>
                        <div class="feature-text">
                            <h3>Calorie Calculation</h3>
                            <p>Precise daily calorie needs based on your BMR and goals</p>
                        </div>
                    </div>
                    <div class="plan-feature">
                        <div class="feature-icon">üçΩÔ∏è</div>
                        <div class="feature-text">
                            <h3>Complete Meals</h3>
                            <p>Breakfast, lunch, dinner, and snack options with instructions</p>
                        </div>
                    </div>
                    <div class="plan-feature">
                        <div class="feature-icon">üí∞</div>
                        <div class="feature-text">
                            <h3>Budget-Friendly</h3>
                            <p>Plans designed to fit your economic preferences</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Overview -->
        <div class="progress-container" id="progressOverview">
            <div class="progress-header">
                <h2>üìä Your Progress</h2>
                <div class="progress-summary">
                    <span id="currentDayDisplay">Day 1</span>
                    <span id="streakDisplay">0 day streak</span>
                </div>
            </div>
            
            <!-- Progress Stats -->
            <div class="progress-stats" id="progressStatsContainer">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Progress Days Grid -->
            <div class="progress-days" id="progressDays">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Today's Workout Section -->
        <div class="workout-container">
            <h2 style="text-align: center; color: var(--primary); margin-bottom: 20px;">üèãÔ∏è Today's Workout</h2>
            <div class="workout-info" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">Day 1</div>
                        <div style="font-size: 0.9rem; color: #666;">Current</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">14</div>
                        <div style="font-size: 0.9rem; color: #666;">Exercises</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">30 min</div>
                        <div style="font-size: 0.9rem; color: #666;">Duration</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">200+</div>
                        <div style="font-size: 0.9rem; color: #666;">Calories</div>
                    </div>
                </div>
            </div>
            <div class="exercise-preview" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <h3 style="color: var(--primary); margin-bottom: 15px;">Sample Exercises for Today:</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üí™</div>
                        <strong>Push-ups</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">3 sets √ó 10 reps</p>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ü¶µ</div>
                        <strong>Squats</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">3 sets √ó 15 reps</p>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">üèãÔ∏è</div>
                        <strong>Plank</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">3 sets √ó 30 sec</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" style="padding: 15px 30px; font-size: 1.1rem;">
                        üèÉ‚Äç‚ôÇÔ∏è Start Today's Workout
                    </button>
                </div>
            </div>
        </div>

        <!-- Nutrition Plan Section -->
        <div class="nutrition-container">
            <h2 style="text-align: center; color: var(--primary); margin-bottom: 20px;">ü•ó Nutrition Plan</h2>
            <div class="nutrition-info" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">2200</div>
                        <div style="font-size: 0.9rem; color: #666;">Daily Calories</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">6</div>
                        <div style="font-size: 0.9rem; color: #666;">Meals/Day</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">Medium</div>
                        <div style="font-size: 0.9rem; color: #666;">Budget Level</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">Goal</div>
                        <div style="font-size: 0.9rem; color: #666;">Muscle Gain</div>
                    </div>
                </div>
            </div>
            <div class="meal-preview" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <h3 style="color: var(--primary); margin-bottom: 15px;">Today's Meal Plan:</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">üç≥</div>
                        <strong>Breakfast</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">Oatmeal with fruits and nuts</p>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">ü•ô</div>
                        <strong>Lunch</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">Grilled chicken with rice</p>
                    </div>
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 1.5rem; margin-bottom: 10px;">üçΩÔ∏è</div>
                        <strong>Dinner</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem; color: #666;">Salmon with vegetables</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" style="padding: 15px 30px; font-size: 1.1rem;">
                        üìñ View Full Meal Plan
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions" style="margin: 30px 0; text-align: center;">
            <button class="btn btn-success" onclick="startTodaysWorkout()" id="startWorkoutBtn">
                üèÉ‚Äç‚ôÇÔ∏è Start Today's Workout
            </button>
            <button class="btn btn-secondary" onclick="viewNutritionPlan()" style="margin-left: 15px;">
                ü•ó View Nutrition Plan
            </button>
            <button class="btn" onclick="updateProfile()" style="margin-left: 15px;">
                ‚öôÔ∏è Update Profile
            </button>
        </div>

        <!-- Emergency/Quick Links -->
        <div class="emergency-section" style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); margin: 20px 0;">
            <h3 style="color: var(--primary); margin-bottom: 15px;">üö® Quick Access</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                <button class="btn btn-warning" onclick="skipTodaysWorkout()">Skip Today</button>
                <button class="btn btn-secondary" onclick="changeWorkoutTime()">Change Time</button>
                <button class="btn" onclick="restartCurrentDay()">Restart Day</button>
                <button class="btn btn-secondary" onclick="viewProgress()">View Stats</button>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2023 Training Club. All rights reserved. and designed by <a href="https://linktr.ee/Mustafa_Bemo" target="_blank" style="color: var(--primary); text-decoration: none;">mustafa</a></p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                Progressive workouts ‚Ä¢ Smart nutrition ‚Ä¢ Real-time tracking
            </p>
        </div>
    </footer>

    <script src="static/js/main.js"></script>
    <script src="static/js/plan.js"></script>
    
    <script>
        // Additional plan-specific functionality
        
        function logout() {
            ModalSystem.show(
                'Confirm Logout',
                'Are you sure you want to log out? Your progress will be saved.',
                [
                    { text: 'Yes, Logout', type: 'danger' },
                    { text: 'Cancel', type: 'secondary' }
                ]
            ).then(result => {
                if (result === 0) {
                    // Clear user data but keep progress
                    const progress = {
                        exerciseProgress: Utils.loadFromStorage('exerciseProgress'),
                        dailyProgress: Utils.loadFromStorage('dailyProgress'),
                        lastWorkoutDate: Utils.loadFromStorage('lastWorkoutDate')
                    };
                    
                    localStorage.clear();
                    
                    // Restore just the progress data
                    if (progress.exerciseProgress) Utils.saveToStorage('exerciseProgress', progress.exerciseProgress);
                    if (progress.dailyProgress) Utils.saveToStorage('dailyProgress', progress.dailyProgress);
                    if (progress.lastWorkoutDate) Utils.saveToStorage('lastWorkoutDate', progress.lastWorkoutDate);
                    
                    NotificationSystem.show('Logged Out', 'Your progress has been saved.', 'success');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                }
            });
        }
        
        function startTodaysWorkout() {
            const workoutContainer = document.getElementById('workoutContainer');
            if (workoutContainer) {
                workoutContainer.scrollIntoView({ behavior: 'smooth' });
                
                // Check if it's workout time
                const userData = Utils.loadFromStorage('userData');
                if (userData && userData.preferredTime) {
                    const now = new Date();
                    const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    
                    if (currentTime !== userData.preferredTime && !Utils.isWorkoutTime(userData.preferredTime)) {
                        ModalSystem.show(
                            'Different Time Detected',
                            `Your preferred workout time is ${userData.preferredTime}, but it's currently ${currentTime}. Do you want to start now anyway?`,
                            [
                                { text: 'Yes, Start Now', type: 'success' },
                                { text: 'Update My Time', type: 'primary' },
                                { text: 'Wait for My Time', type: 'secondary' }
                            ]
                        ).then(result => {
                            if (result === 0) {
                                NotificationSystem.show('Workout Started', 'Great! Let\'s begin your training session.', 'success');
                            } else if (result === 1) {
                                changeWorkoutTime();
                            } else {
                                NotificationSystem.show('Reminder Set', `We'll remind you at ${userData.preferredTime}.`, 'info');
                            }
                        });
                        return;
                    }
                }
                
                NotificationSystem.show('Workout Started', 'Great! Let\'s begin your training session.', 'success');
            } else {
                NotificationSystem.show('Loading...', 'Please wait while we load your workout plan.', 'info');
            }
        }
        
        function viewNutritionPlan() {
            const nutritionContainer = document.getElementById('nutritionContainer');
            if (nutritionContainer) {
                nutritionContainer.scrollIntoView({ behavior: 'smooth' });
                NotificationSystem.show('Nutrition Plan', 'Here\'s your personalized meal plan.', 'info');
            }
        }
        
        function updateProfile() {
            ModalSystem.show(
                'Update Profile',
                'Do you want to update your profile information? This will recalculate your personalized plan.',
                [
                    { text: 'Yes, Update', type: 'primary' },
                    { text: 'Cancel', type: 'secondary' }
                ]
            ).then(result => {
                if (result === 0) {
                    window.location.href = 'profile.html';
                }
            });
        }
        
        function skipTodaysWorkout() {
            ModalSystem.show(
                'Skip Today\'s Workout?',
                'Are you sure you want to skip today\'s workout? This will break your streak but you can restart tomorrow.',
                [
                    { text: 'Yes, Skip Today', type: 'warning' },
                    { text: 'No, Keep Going', type: 'success' }
                ]
            ).then(result => {
                if (result === 0) {
                    // Record skip and move to next day
                    const userData = Utils.loadFromStorage('userData');
                    if (userData && currentWorkoutData) {
                        API.completeDay(userData.user_id, currentWorkoutData.current_day).then(() => {
                            NotificationSystem.show('Day Skipped', 'Tomorrow is a new opportunity to get stronger!', 'warning');
                            // Reload the page to show next day
                            setTimeout(() => location.reload(), 2000);
                        });
                    }
                }
            });
        }
        
        function restartCurrentDay() {
            ModalSystem.show(
                'Restart Current Day?',
                'This will reset all progress for today and let you start fresh. Are you sure?',
                [
                    { text: 'Yes, Restart', type: 'primary' },
                    { text: 'Cancel', type: 'secondary' }
                ]
            ).then(result => {
                if (result === 0) {
                    // Clear today's progress
                    const userData = Utils.loadFromStorage('userData');
                    if (userData && currentWorkoutData) {
                        // Reset exercise progress for current day
                        const exerciseProgress = Utils.loadFromStorage('exerciseProgress') || {};
                        currentWorkoutData.exercises.forEach(exercise => {
                            delete exerciseProgress[exercise.id];
                        });
                        Utils.saveToStorage('exerciseProgress', exerciseProgress);
                        
                        NotificationSystem.show('Day Restarted', 'Your current day has been reset. Ready for a fresh start!', 'success');
                        setTimeout(() => location.reload(), 2000);
                    }
                }
            });
        }
        
        function viewProgress() {
            const progressContainer = document.getElementById('progressOverview');
            if (progressContainer) {
                progressContainer.scrollIntoView({ behavior: 'smooth' });
                
                // Show detailed progress info
                const userData = Utils.loadFromStorage('userData');
                const dailyProgress = Utils.loadFromStorage('dailyProgress') || {};
                const completedDays = Object.keys(dailyProgress).length;
                
                NotificationSystem.show(
                    'üìä Your Progress',
                    `You've completed ${completedDays} days so far. Keep up the great work!`,
                    'info'
                );
            }
        }
        
        // Enhanced BMI display function
        function updateBMIDisplay(userData) {
            if (!userData.bmi) return;
            
            const bmiValue = document.getElementById('bmiValue');
            const bmiMarker = document.getElementById('bmiMarker');
            const bmiInfo = document.getElementById('bmiInfo');
            
            if (bmiValue) bmiValue.textContent = userData.bmi;
            
            // Calculate marker position (BMI scale roughly 15-35)
            const minBMI = 15;
            const maxBMI = 35;
            const position = Math.min(Math.max((userData.bmi - minBMI) / (maxBMI - minBMI) * 100, 0), 100);
            
            if (bmiMarker) {
                bmiMarker.style.left = `${position}%`;
            }
            
            // Get BMI category and advice
            const category = Utils.getBMICategory(userData.bmi);
            
            if (bmiInfo) {
                bmiInfo.innerHTML = `
                    <p><strong>Category:</strong> <span style="color: ${category.color}">${category.category}</span></p>
                    <p><strong>Recommendation:</strong> ${getBMIAdvice(userData.bmi, userData.goal)}</p>
                `;
            }
        }
        
        function getBMIAdvice(bmi, goal) {
            if (bmi < 18.5) {
                return goal === 'muscleGain' ? 
                    'Focus on strength training and increased caloric intake to build healthy muscle mass.' :
                    'Consider consulting a healthcare provider about healthy weight gain strategies.';
            } else if (bmi < 25) {
                return 'You\'re in the healthy range! Maintain your current lifestyle with regular exercise and balanced nutrition.';
            } else if (bmi < 30) {
                return goal === 'weightLoss' ? 
                    'Your workout plan is perfectly designed to help you reach a healthier weight range.' :
                    'Consider incorporating more cardio exercises and reviewing your nutrition plan.';
            } else {
                return 'Focus on gradual weight loss through consistent exercise and nutrition. Consider consulting a healthcare provider.';
            }
        }
        
        // Workout time monitoring
        function monitorWorkoutTime() {
            const userData = Utils.loadFromStorage('userData');
            if (!userData || !userData.preferredTime) return;
            
            const now = new Date();
            const [hours, minutes] = userData.preferredTime.split(':').map(Number);
            const workoutTime = new Date();
            workoutTime.setHours(hours, minutes, 0, 0);
            
            const timeDiff = Math.abs(now - workoutTime);
            const isWorkoutTime = timeDiff <= 30 * 60 * 1000; // Within 30 minutes
            
            const banner = document.getElementById('workoutTimeBanner');
            if (banner) {
                banner.style.display = isWorkoutTime ? 'flex' : 'none';
            }
            
            // Show notification if it's workout time and user hasn't worked out today
            const lastWorkout = Utils.loadFromStorage('lastWorkoutDate');
            const today = new Date().toDateString();
            
            if (isWorkoutTime && lastWorkout !== today) {
                NotificationSystem.show(
                    '‚è∞ Workout Time!',
                    'It\'s your scheduled workout time. Ready to get stronger?',
                    'warning',
                    [
                        { text: 'Start Now', type: 'success', onclick: 'startTodaysWorkout()' },
                        { text: 'Later', type: 'secondary', onclick: 'NotificationSystem.clear()' }
                    ]
                );
            }
        }
        
        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Monitor workout time every minute
            monitorWorkoutTime();
            setInterval(monitorWorkoutTime, 60000);
            
            // Update BMI display when user data is loaded
            const userData = Utils.loadFromStorage('userData');
            if (userData) {
                updateBMIDisplay(userData);
            }
        });
        
        // Make functions globally available for onclick handlers
        window.logout = logout;
        window.startTodaysWorkout = startTodaysWorkout;
        window.viewNutritionPlan = viewNutritionPlan;
        window.updateProfile = updateProfile;
        window.skipTodaysWorkout = skipTodaysWorkout;
        window.restartCurrentDay = restartCurrentDay;
        window.viewProgress = viewProgress;
    </script>
</body>
</html>
